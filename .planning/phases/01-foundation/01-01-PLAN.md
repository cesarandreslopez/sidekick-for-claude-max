---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sidekick-vscode/package.json
  - sidekick-vscode/esbuild.js
  - sidekick-vscode/tsconfig.json
autonomous: true

must_haves:
  truths:
    - "npm install succeeds with both Anthropic SDKs"
    - "npm run build produces bundled extension.js"
    - "npm run watch starts esbuild in watch mode"
  artifacts:
    - path: "sidekick-vscode/package.json"
      provides: "SDK dependencies and esbuild scripts"
      contains: "@anthropic-ai/sdk"
    - path: "sidekick-vscode/esbuild.js"
      provides: "Build configuration"
      min_lines: 20
  key_links:
    - from: "package.json scripts"
      to: "esbuild.js"
      via: "node esbuild.js invocation"
      pattern: "node esbuild"
---

<objective>
Set up build infrastructure with esbuild and install Anthropic SDKs.

Purpose: Replace tsc-based compilation with esbuild for faster builds and install the SDKs needed for both API key and Max subscription authentication modes.
Output: Updated package.json with new dependencies/scripts, esbuild.js configuration file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md

@sidekick-vscode/package.json
@sidekick-vscode/tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and update package.json</name>
  <files>sidekick-vscode/package.json</files>
  <action>
Install the Anthropic SDKs and esbuild:
```bash
cd sidekick-vscode && npm install @anthropic-ai/claude-agent-sdk @anthropic-ai/sdk && npm install -D esbuild
```

Update package.json scripts section to use esbuild:
- Replace "compile": "tsc -p ./" with "compile": "node esbuild.js"
- Replace "watch": "tsc -watch -p ./" with "watch": "node esbuild.js --watch"
- Add "build": "node esbuild.js --production"
- Keep "vscode:prepublish": "npm run build" (change from compile to build)

The scripts should be:
```json
"scripts": {
  "vscode:prepublish": "npm run build",
  "build": "node esbuild.js --production",
  "compile": "node esbuild.js",
  "watch": "node esbuild.js --watch",
  "lint": "eslint src/",
  "lint:fix": "eslint src/ --fix",
  "test": "vitest run",
  "test:watch": "vitest"
}
```
  </action>
  <verify>
Run `cd sidekick-vscode && npm install` - should complete without errors.
Run `cat package.json | grep -A5 '"dependencies"'` - should show both @anthropic-ai packages.
  </verify>
  <done>Both @anthropic-ai/sdk and @anthropic-ai/claude-agent-sdk in dependencies, esbuild in devDependencies, scripts updated.</done>
</task>

<task type="auto">
  <name>Task 2: Create esbuild configuration</name>
  <files>sidekick-vscode/esbuild.js</files>
  <action>
Create esbuild.js based on the pattern from research (VS Code official recommendation):

```javascript
const esbuild = require('esbuild');

const production = process.argv.includes('--production');
const watch = process.argv.includes('--watch');

async function main() {
  const ctx = await esbuild.context({
    entryPoints: ['src/extension.ts'],
    bundle: true,
    format: 'cjs',
    minify: production,
    sourcemap: !production,
    sourcesContent: false,
    platform: 'node',
    outfile: 'out/extension.js',
    external: ['vscode'],
    logLevel: 'warning',
  });

  if (watch) {
    await ctx.watch();
    console.log('Watching for changes...');
  } else {
    await ctx.rebuild();
    await ctx.dispose();
  }
}

main().catch(e => {
  console.error(e);
  process.exit(1);
});
```

This configuration:
- Bundles all dependencies into single file (except vscode which is provided by host)
- Uses CommonJS format (required by VS Code)
- Enables sourcemaps in dev, minifies in production
- Outputs to out/extension.js (same location as before)
  </action>
  <verify>
Run `cd sidekick-vscode && node esbuild.js` - should produce out/extension.js without errors.
Check `ls -la sidekick-vscode/out/extension.js` - file should exist.
  </verify>
  <done>esbuild.js exists and successfully bundles the extension.</done>
</task>

<task type="auto">
  <name>Task 3: Update tsconfig.json for esbuild compatibility</name>
  <files>sidekick-vscode/tsconfig.json</files>
  <action>
Update tsconfig.json to work alongside esbuild (esbuild handles compilation, but we still want TypeScript for type checking):

Ensure these settings:
- "noEmit": true (esbuild does the emit, not tsc)
- Keep strict type checking enabled
- Ensure "moduleResolution": "node" for SDK compatibility

The config should support running `tsc --noEmit` for type checking while esbuild handles actual bundling.

If "noEmit" is not already true, add it. If there's an "outDir" setting, it can stay (won't matter with noEmit: true).
  </action>
  <verify>
Run `cd sidekick-vscode && npx tsc --noEmit` - should pass type checking.
Run `cd sidekick-vscode && npm run compile` - should use esbuild and produce out/extension.js.
  </verify>
  <done>tsconfig.json configured for type checking only, esbuild handles bundling.</done>
</task>

</tasks>

<verification>
After all tasks:
1. `cd sidekick-vscode && npm install` - succeeds
2. `npm run compile` - produces out/extension.js via esbuild
3. `npm run watch` - starts esbuild watch mode (Ctrl+C to exit)
4. `npm run build` - produces minified production build
5. `npx tsc --noEmit` - type checking passes
</verification>

<success_criteria>
- Both Anthropic SDKs installed as dependencies
- esbuild installed as devDependency
- esbuild.js configuration file exists and works
- npm run compile/watch/build all use esbuild
- TypeScript type checking still works via tsc --noEmit
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
